(function(){"use strict";var e={492:function(e,t,n){var s=n(1930),r=n(8047);const l={id:"app"};function a(e,t,n,s,a,i){const u=(0,r.g2)("GameTable"),o=(0,r.g2)("TestTable");return(0,r.uX)(),(0,r.CE)("div",l,[a.showGame?(0,r.Q3)("",!0):((0,r.uX)(),(0,r.CE)("button",{key:0,onClick:t[0]||(t[0]=e=>a.showGame=!0)},"开始")),a.showTest?(0,r.Q3)("",!0):((0,r.uX)(),(0,r.CE)("button",{key:1,onClick:t[1]||(t[1]=e=>a.showTest=!0)},"测试")),a.showGame?((0,r.uX)(),(0,r.Wv)(u,{key:2})):(0,r.Q3)("",!0),a.showTest?((0,r.uX)(),(0,r.Wv)(o,{key:3})):(0,r.Q3)("",!0)])}var i=n(934);const u={class:"game-table"},o={class:"top-container"},c={class:"recorder-top-bar"},d={class:"recorder-top-inner"},h={class:"ai-row-on-top"},f={class:"ai-block-wrap"},p=["onClick"],g={class:"player-label"},v={class:"player-hand-count"},y={class:"table-center"},m={class:"current-play history-scroll",ref:"historyScroll"},b={key:0,ref:"historyList",class:"history-list"},C={class:"history-name"},k={key:0,class:"history-cards"},x={class:"card-corner top-left"},L={class:"card-corner bottom-right"},T={key:1,class:"history-pass"},I={key:1},S={class:"fixed-play-info"},w={class:"current-play-area"},E={class:"play-area-cards"},A={class:"card-corner top-left"},P={class:"card-corner bottom-right"},$={key:1,class:"play-pass"},O={class:"bottom-bar"},_={class:"actions"},X=["disabled"],H=["disabled"],K={key:0,class:"winner-modal"},F={class:"winner-content"};function Q(e,t,n,s,l,a){const Q=(0,r.g2)("Recorder"),R=(0,r.g2)("CardHand");return(0,r.uX)(),(0,r.CE)("div",u,[(0,r.Lk)("div",o,[(0,r.Lk)("div",c,[(0,r.Lk)("div",d,[(0,r.bF)(Q,{players:l.players,cardOrder:l.cardOrder},null,8,["players","cardOrder"])])]),(0,r.Lk)("div",h,[(0,r.Lk)("div",f,[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(l.players,(e,t)=>((0,r.uX)(),(0,r.CE)("div",{key:t,class:(0,i.C4)(["player-tab",{active:l.currentTurn===t,me:0===t}]),onClick:e=>a.toggleHand(t)},[(0,r.Lk)("span",g,(0,i.v_)(0===t?"我":e.name),1),(0,r.Lk)("span",v,"剩余："+(0,i.v_)(e.hand.length)+" 张",1)],10,p))),128))])])]),(0,r.Lk)("div",y,[(0,r.Lk)("div",m,[t[3]||(t[3]=(0,r.Lk)("div",null,"出牌记录：",-1)),l.historyPlays.length?((0,r.uX)(),(0,r.CE)("div",b,[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(l.historyPlays,(e,t)=>((0,r.uX)(),(0,r.CE)("div",{key:t,class:"history-item"},[(0,r.Lk)("span",C,(0,i.v_)(e.name)+"：",1),e.cards.length?((0,r.uX)(),(0,r.CE)("span",k,[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(e.cards,(e,t)=>((0,r.uX)(),(0,r.CE)("span",{key:t,class:(0,i.C4)(["card-item",a.getSuitClass(e.suit)])},[(0,r.Lk)("span",x,[(0,r.Lk)("span",{class:(0,i.C4)(["corner-value",a.getSuitClass(e.suit)])},(0,i.v_)(e.value),3),(0,r.Lk)("span",{class:(0,i.C4)(["corner-suit",a.getSuitClass(e.suit)])},(0,i.v_)(e.suit),3)]),(0,r.Lk)("span",L,[(0,r.Lk)("span",{class:(0,i.C4)(["corner-value",a.getSuitClass(e.suit)])},(0,i.v_)(e.value),3),(0,r.Lk)("span",{class:(0,i.C4)(["corner-suit",a.getSuitClass(e.suit)])},(0,i.v_)(e.suit),3)])],2))),128))])):((0,r.uX)(),(0,r.CE)("span",T,"不要"))]))),128))],512)):((0,r.uX)(),(0,r.CE)("div",I,"无"))],512)]),(0,r.Lk)("div",S,[(0,r.Lk)("div",w,[t[4]||(t[4]=(0,r.Lk)("div",{class:"play-area-label"},"当前出牌：",-1)),(0,r.Lk)("div",E,[l.currentPlay&&l.currentPlay.length?((0,r.uX)(!0),(0,r.CE)(r.FK,{key:0},(0,r.pI)(l.currentPlay,(e,t)=>((0,r.uX)(),(0,r.CE)("span",{key:t,class:(0,i.C4)(["card-item",a.getSuitClass(e.suit)])},[(0,r.Lk)("span",A,[(0,r.Lk)("span",{class:(0,i.C4)(["corner-value",a.getSuitClass(e.suit)])},(0,i.v_)(e.value),3),(0,r.Lk)("span",{class:(0,i.C4)(["corner-suit",a.getSuitClass(e.suit)])},(0,i.v_)(e.suit),3)]),(0,r.Lk)("span",P,[(0,r.Lk)("span",{class:(0,i.C4)(["corner-value",a.getSuitClass(e.suit)])},(0,i.v_)(e.value),3),(0,r.Lk)("span",{class:(0,i.C4)(["corner-suit",a.getSuitClass(e.suit)])},(0,i.v_)(e.suit),3)])],2))),128)):((0,r.uX)(),(0,r.CE)("span",$,"不要"))])])]),(0,r.Lk)("div",O,[(0,r.Lk)("div",_,[(0,r.Lk)("button",{onClick:t[0]||(t[0]=(...e)=>a.playCards&&a.playCards(...e)),disabled:a.canPlay},"出牌",8,X),(0,r.Lk)("button",{onClick:t[1]||(t[1]=(...e)=>a.pass&&a.pass(...e)),disabled:a.canPass},"不要",8,H)]),(0,r.bF)(R,{hand:l.players[0].hand,selectedIndexes:l.selectedIndexes,getSuitClass:a.getSuitClass,onToggleSelect:a.toggleSelect},null,8,["hand","selectedIndexes","getSuitClass","onToggleSelect"])]),null!==l.winner?((0,r.uX)(),(0,r.CE)("div",K,[(0,r.Lk)("div",F,[(0,r.Lk)("div",null,"胜者："+(0,i.v_)(l.players[l.winner].name),1),(0,r.Lk)("button",{onClick:t[2]||(t[2]=(...e)=>a.startGame&&a.startGame(...e))},"再来一局")])])):(0,r.Q3)("",!0),null!==l.hoverHandIdx?((0,r.uX)(),(0,r.CE)("div",{key:1,style:(0,i.Tr)(l.hoverHandStyle),class:"hand-tooltip-debug"},[(0,r.bF)(R,{hand:l.players[l.hoverHandIdx].hand,selectedIndexes:[],getSuitClass:a.getSuitClass},null,8,["hand","getSuitClass"])],4)):(0,r.Q3)("",!0)])}n(1201),n(6040),n(2144),n(9062),n(198);const R=["♠","♥","♣","♦"],B=["4","6","7","8","9","10","J","Q","K","A","2","3","5"],G=["4","6","7","8","9","10","J","Q","K","A"];function W(){const e=[];for(const t of R)for(const n of B)e.push({suit:t,value:n});return e}function j(e){for(let t=e.length-1;t>0;t--){const n=Math.floor(Math.random()*(t+1));[e[t],e[n]]=[e[n],e[t]]}return e}function J(e){const t=[[],[],[],[]];for(let n=0;n<e.length;n++)t[n%4].push(e[n]);for(let n=0;n<4;n++)t[n].sort((e,t)=>B.indexOf(e.value)-B.indexOf(t.value));return t}n(3047),n(5129),n(8773),n(2695),n(5777),n(5708),n(5633),n(922),n(5889),n(637);const V="single",U="pair",N="triple",q="bomb",M="straight",D="doubleStraight",z="invalid";function Y(e,t){return B.indexOf(e.value)-B.indexOf(t.value)}function Z(e,t){if(!e||0===e.length)return!1;const n=te(e);if(n===z)return!1;if(!t||0===t.length)return!0;const s=te(t);if(n===q&&s!==q)return!0;if(n===N&&s!==q&&s!==N)return!0;if(n!==s)return!1;if(e.length!==t.length)return!1;const r=ee(e),l=ee(t);return Y(r[e.length-1],l[t.length-1])>0}function ee(e){return e.slice().sort(Y)}function te(e){return 1===e.length?V:2===e.length&&e[0].value===e[1].value?U:3===e.length&&e[0].value===e[1].value&&e[1].value===e[2].value?N:4===e.length&&e[0].value===e[1].value&&e[1].value===e[2].value&&e[2].value===e[3].value?q:le(e)?M:ae(e)?D:z}function ne(e){return 2===e.length&&e[0].value===e[1].value}function se(e){return 3===e.length&&e[0].value===e[1].value&&e[1].value===e[2].value}function re(e){return 4===e.length&&e[0].value===e[1].value&&e[1].value===e[2].value&&e[2].value===e[3].value}function le(e){if(e.length<3)return!1;const t=e.map(e=>G.indexOf(e.value)).sort((e,t)=>e-t);if(t.includes(-1))return!1;for(let n=1;n<t.length;n++){if("K"===G[t[n-1]]&&"A"!==G[t[n]])return!1;if(("K"!==G[t[n-1]]||"A"!==G[t[n]])&&t[n]-t[n-1]!==1)return!1}return!0}function ae(e){if(e.length<4||e.length%2!==0)return!1;const t=e.slice().sort(Y);for(let n=0;n<t.length;n+=2){if(t[n].value!==t[n+1].value)return!1;if(n>0){const e=G.indexOf(t[n].value),s=G.indexOf(t[n-2].value);if(-1===s||-1===e)return!1;if("K"===G[s]&&"A"!==G[e])return!1;if(("K"!==G[s]||"A"!==G[e])&&e-s!==1)return!1}}return!0}function ie(e,t=[]){const n=[];for(const s of e)s.cards&&s.cards.length&&n.push(...s.cards);return t&&t.length&&n.push(...t),n}function ue(e,t){const n=B,s=[];for(const a of R)for(const e of n)s.push({suit:a,value:e});const r=ie(t,e),l=new Set(r.map(e=>`${e.suit}${e.value}`));return s.filter(e=>!l.has(`${e.suit}${e.value}`))}function oe(e){return e&&0!==e.length?e.slice().sort((e,t)=>B.indexOf(e[0].value)-B.indexOf(t[0].value))[0]:null}function ce(e){return e&&0!==e.length?e.slice().sort((e,t)=>B.indexOf(e[0].value)-B.indexOf(t[0].value))[0]:null}function de(e){return e&&0!==e.length?e.slice().sort((e,t)=>e.length-t.length||B.indexOf(e[0].value)-B.indexOf(t[0].value))[0]:null}function he(e,t,n,s,r,l){const a=s%4+1,i=Qe(n,l,r),u=Re(n,t.length||4),o=t[u]??99;let c="normal";return i.some(e=>(t[e]??99)<=2)?c="team":e.length<=5||o<=2?c="aggressive":a<=3&&(c="conservative"),{style:c,round:a,teammateIndexes:i,nextPlayerIdx:u}}function fe(e){const t=["2","A","5","3"],n={2:0,A:0,5:0,3:0,bomb:0,triple:0};for(const r of e)t.includes(r.value)&&n[r.value]++;const s={};for(const r of e)s[r.value]=(s[r.value]||0)+1;for(const r in s)s[r]>=4?n.bomb++:s[r]>=3&&n.triple++;return n}function pe(e,t,n){const s=Ie(e,t,n);return{combos:s,triples:s.filter(e=>3===e.length&&se(e)),bombs:s.filter(e=>4===e.length&&re(e)),straights:s.filter(e=>e.length>=3&&Xe(e)),doubleStraights:s.filter(e=>e.length>=4&&He(e)),pairs:s.filter(e=>2===e.length&&ne(e)),singles:s.filter(e=>1===e.length)}}function ge(e,t){let n=!1,s=null;if(e&&e.length){for(let t=e.length-1;t>=0;t--){const n=e[t];if(n&&n.cards&&n.cards.length){s=n;break}}if(s&&"number"===typeof s.playerIndex&&s.playerIndex===t){let t=!1;for(let n=e.indexOf(s)+1;n<e.length;n++){const s=e[n];if(s&&s.cards&&s.cards.length){t=!0;break}}t||(n=!0)}}return{wonLastTurn:n,lastNonEmptyPlay:s}}function ve(e,t,n){let{straights:s,doubleStraights:r,pairs:l,singles:a,triples:i}=n;if(e&&t&&t.cards){const e=t.cards,n=t=>t.filter(t=>!Z(t,e));s=n(s),r=n(r),l=n(l),a=n(a),i=n(i)}return{straights:s,doubleStraights:r,pairs:l,singles:a,triples:i}}function ye(e,t,n,s,r){const l=s&&s.includes(t);if(l)return!1;const a=e[t]??99;if("number"===typeof a&&a<=2)return!0;if(!n||0===n.length)return!1;const i=n[n.length-1]||n[0];if(!i||!i.value)return!1;const u=r.filter(e=>e.value===i.value).length;return u>0}function me(e){const{lastCards:t,lastOwnerIsTeammate:n,lastOwnerHandCount:s,wonLastTurn:r,singles:l,pairs:a,straights:i,doubleStraights:u,bombs:o,triples:c,safe:d,nextPlayerIdx:h,round:f,combos:p,sorted:g,teammateIndexes:v,handCounts:y,remainingCards:m}=e;if(t&&t.length>0&&n&&s<=2){const e=ye(y,h,t,v,m);if(e){const e=Ce({lastCards:t,bombs:o,triples:c,straights:i,doubleStraights:u,combos:p,sorted:g,wonLastTurn:r,safe:d,round:f});if(e&&e.length)return e}return[]}if(r&&(!t||0===t.length)){const e=oe(l);if(e)return e;const t=ce(a);if(t)return t;const n=de(i);if(n)return n;const s=de(u);if(s)return s}const b=(r?d.singles:l).filter(e=>!["2","A"].includes(e[0].value));if(b.length>0)return b[0];const C=(r?d.pairs:a).filter(e=>!["2","A"].includes(e[0].value));if(C.length>0)return C[0];const k=(r?d.straights:i).filter(e=>e.every(e=>!["2","A"].includes(e.value)));if(k.length>0)return k[0];const x=(r?d.doubleStraights:u).filter(e=>e.every(e=>!["2","A"].includes(e.value)));if(x.length>0)return x[0];const L=(r?d.triples:c).filter(e=>!["2","A"].includes(e[0].value));return L.length>0?L[0]:o.length>0?o[0]:null}function be(e){const{lastCards:t,combos:n,wonLastTurn:s,singles:r,pairs:l,straights:a,doubleStraights:i,bombs:u,triples:o,safe:c}=e;if(t&&t.length>0){for(let e=n.length-1;e>=0;e--)if(Z(n[e],t))return n[e];return[]}if(s){const e=oe(r);if(e)return e;const t=ce(l);if(t)return t;const n=de(a);if(n)return n;const s=de(i);if(s)return s}const d=(s?c.straights:a).filter(e=>e.every(e=>!["2","A"].includes(e.value)));if(d.length>0)return d[0];const h=(s?c.doubleStraights:i).filter(e=>e.every(e=>!["2","A"].includes(e.value)));if(h.length>0)return h[0];const f=(s?c.triples:o).filter(e=>!["2","A"].includes(e[0].value));if(f.length>0)return f[0];const p=(s?c.pairs:l).filter(e=>!["2","A"].includes(e[0].value));if(p.length>0)return p[0];const g=(s?c.singles:r).filter(e=>!["2","A"].includes(e[0].value));return g.length>0?g[0]:u.length>0?u[0]:null}function Ce(e){const{lastCards:t,bombs:n,triples:s,straights:r,doubleStraights:l,combos:a,sorted:i,wonLastTurn:u,safe:o,round:c}=e;for(const d of n)if(Z(d,t))return d;if(se(t)){if(c<=3){for(const e of n)if(Z(e,t))return e;return[]}for(const e of s)if(Z(e,t))return e;for(const e of n)if(Z(e,t))return e;return[]}if((Ke(t)||Fe(t))&&c<=3){for(const e of s)if(Z(e,t))return e;for(const e of n)if(Z(e,t))return e}if(Xe(t)){for(const e of u?o.straights:r)if(Z(e,t))return e;for(const e of n)if(Z(e,t))return e;return[]}if(He(t)){for(const e of u?o.doubleStraights:l)if(Z(e,t))return e;for(const e of n)if(Z(e,t))return e;return[]}for(const d of a)if(!re(d)&&!se(d)&&Z(d,t)&&!Le(d,i,a)&&(1===d.length||2===d.length))return d;for(const d of a)if(!re(d)&&Z(d,t)&&!Le(d,i,a))return d;for(const d of a)if(Z(d,t))return d;return[]}function ke(e){const{lastCards:t,combos:n,hand:s,wonLastTurn:r,singles:l,pairs:a,straights:i,doubleStraights:u,bombs:o,triples:c,keyCount:d,sorted:h}=e;if(t&&t.length>0){for(const e of n)if(Z(e,t))return e;return[]}if(s.length>5){if(r){const e=oe(l);if(e)return e;const t=ce(a);if(t)return t;const n=de(i);if(n)return n;const s=de(u);if(s)return s}if(d["2"]>0&&l.length>0){const e=l.find(e=>"2"!==e[0].value);if(e)return e}if(d["A"]>0&&l.length>0){const e=l.find(e=>"A"!==e[0].value);if(e)return e}if(d.bomb>0&&o.length>0){const e=l.length>0?l[0]:null;if(e)return e}return a.length>0?a[0]:i.length>0?i[0]:u.length>0?u[0]:l.length>0?l[0]:c.length>0?c[0]:o.length>0?o[0]:[h[0]]}return l.length>0?l[0]:a.length>0?a[0]:c.length>0?c[0]:i.length>0?i[0]:u.length>0?u[0]:o.length>0?o[0]:[h[0]]}function xe(e,t=[],n,s=0,r=[],l=[],a=[]){const{style:i,round:u,teammateIndexes:o,nextPlayerIdx:c}=he(e,l,s,n,r,a);if(!e||0===e.length)return[];const d=ee(e),h=ue(e,r),f=fe(h),{combos:p,triples:g,bombs:v,straights:y,doubleStraights:m,pairs:b,singles:C}=pe(d,u,e.length),{wonLastTurn:k,lastNonEmptyPlay:x}=ge(r,s),L=ve(k,x,{straights:y,doubleStraights:m,pairs:b,singles:C,triples:g});let T=-1;x&&"number"===typeof x.playerIndex&&(T=x.playerIndex);const I=o.includes(T),S=T>=0?l[T]??99:99;if("team"===i){const e=me({lastCards:t,lastOwnerIsTeammate:I,lastOwnerHandCount:S,wonLastTurn:k,singles:C,pairs:b,straights:y,doubleStraights:m,bombs:v,triples:g,safe:L,nextPlayerIdx:c,round:u,combos:p,sorted:d,teammateIndexes:o,handCounts:l,remainingCards:h});return e||[d[0]]}if("aggressive"===i){const e=be({lastCards:t,combos:p,wonLastTurn:k,singles:C,pairs:b,straights:y,doubleStraights:m,bombs:v,triples:g,safe:L});return e||[d[0]]}return t&&t.length>0?Ce({lastCards:t,bombs:v,triples:g,straights:y,doubleStraights:m,combos:p,sorted:d,wonLastTurn:k,safe:L,round:u}):ke({lastCards:t,combos:p,hand:e,wonLastTurn:k,singles:C,pairs:b,straights:y,doubleStraights:m,bombs:v,triples:g,keyCount:f,sorted:d})}function Le(e,t,n){for(const s of n)if(s.some(t=>e.includes(t))&&!Te(s,e))return!0;return!1}function Te(e,t){if(e.length!==t.length)return!1;for(let n=0;n<e.length;n++)if(e[n]!==t[n])return!1;return!0}function Ie(e,t,n){const s=[],r=new Set,l=$e(e,r);l.forEach(e=>e.forEach(e=>r.add(`${e.suit}${e.value}`)));const a=Pe(e,r);a.forEach(e=>e.forEach(e=>r.add(`${e.suit}${e.value}`)));const i=Se(e,r);i.forEach(e=>e.forEach(e=>r.add(`${e.suit}${e.value}`)));const u=we(e,r);u.forEach(e=>e.forEach(e=>r.add(`${e.suit}${e.value}`)));const o=Ee(e,r);o.forEach(e=>e.forEach(e=>r.add(`${e.suit}${e.value}`)));const c=Ae(e,r);return c.forEach(e=>e.forEach(e=>r.add(`${e.suit}${e.value}`))),s.push(...i,...u,...o,...c),(t>3||n<=5)&&s.push(...a,...l),s}function Se(e,t){const n=[];for(let s=3;s<=e.length;s++)for(let r=0;r<=e.length-s;r++){const l=e.slice(r,r+s);!Xe(l)||Oe(l)||_e(l,t)||(n.push(l),l.forEach(e=>t.add(`${e.suit}${e.value}`)))}return n}function we(e,t){const n=[];for(let s=4;s<=e.length;s+=2)for(let r=0;r<=e.length-s;r++){const l=e.slice(r,r+s);!He(l)||Oe(l)||_e(l,t)||(n.push(l),l.forEach(e=>t.add(`${e.suit}${e.value}`)))}return n}function Ee(e,t){const n=[];for(let s=0;s<e.length-1;s++)e[s].value!==e[s+1].value||_e([e[s],e[s+1]],t)||(n.push([e[s],e[s+1]]),t.add(`${e[s].suit}${e[s].value}`),t.add(`${e[s+1].suit}${e[s+1].value}`));return n}function Ae(e,t){const n=[];for(const s of e)_e([s],t)||(n.push([s]),t.add(`${s.suit}${s.value}`));return n}function Pe(e,t){const n=[];for(let s=0;s<e.length-2;s++)e[s].value!==e[s+1].value||e[s].value!==e[s+2].value||_e([e[s],e[s+1],e[s+2]],t)||(n.push([e[s],e[s+1],e[s+2]]),t.add(`${e[s].suit}${e[s].value}`),t.add(`${e[s+1].suit}${e[s+1].value}`),t.add(`${e[s+2].suit}${e[s+2].value}`));return n}function $e(e,t){const n=[];for(let s=0;s<e.length-3;s++)e[s].value!==e[s+1].value||e[s].value!==e[s+2].value||e[s].value!==e[s+3].value||_e([e[s],e[s+1],e[s+2],e[s+3]],t)||(n.push([e[s],e[s+1],e[s+2],e[s+3]]),t.add(`${e[s].suit}${e[s].value}`),t.add(`${e[s+1].suit}${e[s+1].value}`),t.add(`${e[s+2].suit}${e[s+2].value}`),t.add(`${e[s+3].suit}${e[s+3].value}`));return n}function Oe(e){const t=new Set;for(const n of e){if(t.has(n.suit))return!0;t.add(n.suit)}return!1}function _e(e,t){for(const n of e)if(t.has(`${n.suit}${n.value}`))return!0;return!1}function Xe(e){return le(e)}function He(e){return ae(e)}function Ke(e){return le(e)&&e.length>=5}function Fe(e){return ae(e)&&e.length>=6}function Qe(e,t,n){let s=null;if(n&&n.length)for(const r of n)if(r.cards&&r.cards.some(e=>"♠"===e.suit&&"5"===e.value)){"number"===typeof r.playerIndex&&(s=r.playerIndex);break}if(null!==s){const n=t.map((e,t)=>t).filter(n=>(t[n]||n===s)&&n!==e);return n}return t.map((e,t)=>t).filter(n=>t[n]&&n!==e)}function Re(e,t){return(e+1)%t}const Be={class:"hand-outer"},Ge=["onClick"],We={class:"card-corner top-left"},je={class:"card-corner bottom-right"};function Je(e,t,n,s,l,a){return(0,r.uX)(),(0,r.CE)("div",Be,[(0,r.Lk)("div",{class:"hand",ref:"myHand",style:(0,i.Tr)({width:a.handWidth+"px"})},[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(n.hand,(e,t)=>((0,r.uX)(),(0,r.CE)("span",{key:t,class:(0,i.C4)([{selected:n.selectedIndexes.includes(t)},n.getSuitClass(e.suit),"card-item"]),onClick:e=>a.toggleSelect(t),style:(0,i.Tr)({left:22*t+"px",zIndex:t})},[(0,r.Lk)("span",We,[(0,r.Lk)("span",{class:(0,i.C4)(["corner-value",n.getSuitClass(e.suit)])},(0,i.v_)(e.value),3),(0,r.Lk)("span",{class:(0,i.C4)(["corner-suit",n.getSuitClass(e.suit)])},(0,i.v_)(e.suit),3)]),(0,r.Lk)("span",je,[(0,r.Lk)("span",{class:(0,i.C4)(["corner-value",n.getSuitClass(e.suit)])},(0,i.v_)(e.value),3),(0,r.Lk)("span",{class:(0,i.C4)(["corner-suit",n.getSuitClass(e.suit)])},(0,i.v_)(e.suit),3)])],14,Ge))),128))],4)])}var Ve={name:"CardHand",props:{hand:Array,selectedIndexes:Array,getSuitClass:Function},emits:["toggleSelect"],computed:{handWidth(){return this.hand&&0!==this.hand.length?1===this.hand.length?44:44+22*(this.hand.length-1):0}},methods:{toggleSelect(e){this.$emit("toggleSelect",e)}}},Ue=n(7017);const Ne=(0,Ue.A)(Ve,[["render",Je],["__scopeId","data-v-65454eae"]]);var qe=Ne;const Me={class:"recorder"},De={class:"recorder-cards"},ze={class:"recorder-row"},Ye={class:"recorder-row"};function Ze(e,t,n,s,l,a){return(0,r.uX)(),(0,r.CE)("div",Me,[t[0]||(t[0]=(0,r.Lk)("div",{class:"recorder-title"},"记牌器",-1)),(0,r.Lk)("div",De,[(0,r.Lk)("div",ze,[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(n.cardOrder,e=>((0,r.uX)(),(0,r.CE)("span",{key:e,class:"recorder-num"},(0,i.v_)(e),1))),128))]),(0,r.Lk)("div",Ye,[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(n.cardOrder,e=>((0,r.uX)(),(0,r.CE)("span",{key:e,class:"recorder-count"},(0,i.v_)(a.getCardLeftCount(n.players,e)),1))),128))])])])}function et(e,t){let n=0;for(let s=1;s<e.length;s++)n+=e[s].hand.filter(e=>e.value===t).length;return n}var tt={name:"Recorder",props:{players:Array,cardOrder:{type:Array,default:()=>B}},methods:{getCardLeftCount:et}};const nt=(0,Ue.A)(tt,[["render",Ze],["__scopeId","data-v-324b625c"]]);var st=nt,rt={name:"GameTable",components:{CardHand:qe,Recorder:st},created(){this.players=[{name:"自己",isAI:!1,isBanker:!0,team:0,hand:[]},{name:"AI1",isAI:!0,isBanker:!1,team:1,hand:[]},{name:"AI2",isAI:!0,isBanker:!1,team:1,hand:[]},{name:"AI3",isAI:!0,isBanker:!1,team:1,hand:[]}]},data(){return{players:[],cardOrder:["4","6","7","8","9","10","J","Q","K","A","2","3","5"],currentTurn:0,playNumber:0,currentPlay:[],winner:null,selectedIndexes:[],historyPlays:[],hoverHandIdx:null,hoverHandStyle:{}}},watch:{historyPlays:{handler(){this.$nextTick(()=>{const e=this.$refs.historyList;e&&requestAnimationFrame(()=>{e.scrollTop=e.scrollHeight,requestAnimationFrame(()=>{e.scrollTop=e.scrollHeight})})})},deep:!0}},computed:{canPlay(){return this.players[this.currentTurn].isAI||null!==this.winner||0===this.selectedIndexes.length},canPass(){const e=this.getLastValidPlay();return this.players[this.currentTurn].isAI||null!==this.winner||0===this.historyPlays.length||e.name===this.players[this.currentTurn].name}},methods:{startGame(){const e=j(W()),t=J(e);for(let n=0;n<4;n++)this.players[n].hand=t[n],this.hasBlackFive(this.players[n]);this.currentTurn=0,this.currentPlay=[],this.historyPlays=[],this.winner=null,this.selectedIndexes=[]},getLastValidPlay(){for(let e=this.historyPlays.length-1;e>=0;e--)if(this.historyPlays[e].cards&&this.historyPlays[e].cards.length>0)return this.historyPlays[e];return null},hasBlackFive(e){for(let t=0;t<e.hand.length;t++)if("♥"===e.hand[t].suit&&"5"===e.hand[t].value)return void(e.team=0)},playCards(){const e=this.players[this.currentTurn];if(0===this.selectedIndexes.length)return;const t=this.selectedIndexes.slice().sort((e,t)=>e-t),n=t.map(t=>e.hand[t]),s=this.getLastValidPlay();let r=[];if(s&&s.name!==e.name&&(r=s.cards),Z(n,r)){this.currentPlay=n,this.historyPlays.push({playerIndex:this.currentTurn,name:e.name,cards:n.map(e=>({...e}))});for(let n=t.length-1;n>=0;n--)e.hand.splice(t[n],1);this.selectedIndexes=[],this.checkWinner(),this.nextTurn()}else alert("手牌小")},getSuitClass(e){return"♥"===e||"♦"===e?"red-suit":"♠"===e||"♣"===e?"black-suit":""},toggleSelect(e){if(0!==this.currentTurn||null!==this.winner)return;const t=this.selectedIndexes.indexOf(e);this.selectedIndexes=-1===t?[...this.selectedIndexes,e]:this.selectedIndexes.filter(t=>t!==e)},pass(){0===this.historyPlays.length&&alert("第一次不允许不出");const e=this.players[this.currentTurn];this.historyPlays.push({playerIndex:this.currentTurn,name:e.name,cards:[]}),this.currentPlay=[],this.nextTurn()},nextTurn(){if(null!==this.winner)return;this.currentTurn=(this.currentTurn+1)%4,this.playNumber++;const e=this.players[this.currentTurn];e.isAI&&this.aiPlay()},aiPlay(){const e=this.players[this.currentTurn];e.hand.length>0?setTimeout(()=>{const t=this.getLastValidPlay();let n=[];t&&t.name!==e.name&&(n=t.cards);const s=xe(e.hand,n,this.playNumber,this.currentTurn,this.historyPlays,this.players.map(e=>e.hand.length),this.players.map(e=>e.isBanker));s&&s.length>0?(this.currentPlay=s,this.historyPlays.push({playerIndex:this.currentTurn,name:e.name,cards:s.map(e=>({...e}))}),e.hand=e.hand.filter(e=>!s.some(t=>t.suit===e.suit&&t.value===e.value))):(this.historyPlays.push({playerIndex:this.currentTurn,name:e.name,cards:[]}),this.currentPlay=[]),this.checkWinner(),this.nextTurn()},700+800*Math.random()):(this.currentPlay=[],this.checkWinner(),this.nextTurn())},checkWinner(){for(let e=0;e<4;e++)0===this.players[e].hand.length&&(this.winner=e)},toggleHand(e){this.hoverHandIdx===e?this.hideHand():this.showHand(e)},showHand(e){this.hoverHandIdx=e,this.hoverHandStyle={position:"fixed",left:"50%",top:"21%",transform:"translate(-50%, -50%)",zIndex:1e3,background:"#fff",border:"1px solid #ccc",padding:"8px",boxShadow:"0 2px 8px rgba(0,0,0,0.15)",borderRadius:"4px",minWidth:"180px",minHeight:"100px"}},hideHand(){this.hoverHandIdx=null},handleBodyClick(e){if(null!==this.hoverHandIdx){const t=this.$el.querySelector(".hand-tooltip-debug"),n=this.$el.querySelectorAll(".player-tab");if(t&&t.contains(e.target)||Array.from(n).some(t=>t.contains(e.target)))return;this.hideHand()}}},mounted(){this.startGame(),document.body.addEventListener("click",this.handleBodyClick,!0)},beforeUnmount(){document.body.removeEventListener("click",this.handleBodyClick,!0)}};const lt=(0,Ue.A)(rt,[["render",Q],["__scopeId","data-v-08e32bee"]]);var at=lt;const it={class:"test-table"},ut={key:0,style:{"margin-top":"8px"}},ot={style:{"margin-top":"12px"}},ct={key:0,style:{"margin-top":"6px"}},dt={style:{"margin-top":"12px"}},ht={key:0,style:{"margin-top":"6px"}};function ft(e,t,n,l,a,u){return(0,r.uX)(),(0,r.CE)("div",it,[(0,r.Lk)("div",null,[t[6]||(t[6]=(0,r.Lk)("span",null,"Selected Cards:",-1)),(0,r.bo)((0,r.Lk)("input",{type:"input","onUpdate:modelValue":t[0]||(t[0]=e=>a.selectedCards=e),placeholder:"如: 7,7 或 ♠7,♥7"},null,512),[[s.Jo,a.selectedCards]])]),(0,r.Lk)("div",null,[t[7]||(t[7]=(0,r.Lk)("span",null,"Last Cards:",-1)),(0,r.bo)((0,r.Lk)("input",{type:"input","onUpdate:modelValue":t[1]||(t[1]=e=>a.lastCards=e),placeholder:"如: 6,6 或 ♣6,♦6"},null,512),[[s.Jo,a.lastCards]])]),(0,r.Lk)("button",{onClick:t[2]||(t[2]=(...e)=>u.testPlay&&u.testPlay(...e))},"Test Play"),null!==a.result?((0,r.uX)(),(0,r.CE)("div",ut,[(0,r.Lk)("div",null,"Is valid: "+(0,i.v_)(a.result),1),(0,r.Lk)("div",null,"Selected Type: "+(0,i.v_)(a.selType),1),(0,r.Lk)("div",null,"Last Type: "+(0,i.v_)(a.lastType),1)])):(0,r.Q3)("",!0),(0,r.Lk)("div",ot,[(0,r.Lk)("button",{onClick:t[3]||(t[3]=(...e)=>u.runSamples&&u.runSamples(...e))},"Run Samples"),a.sampleResults.length?((0,r.uX)(),(0,r.CE)("div",ct,[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(a.sampleResults,(e,t)=>((0,r.uX)(),(0,r.CE)("div",{key:t},(0,i.v_)(t+1)+". "+(0,i.v_)(e.selected)+" | "+(0,i.v_)(e.last)+" => "+(0,i.v_)(e.actual)+" (expect "+(0,i.v_)(e.expect)+")",1))),128))])):(0,r.Q3)("",!0)]),(0,r.Lk)("div",dt,[t[8]||(t[8]=(0,r.Lk)("span",null,"Type Cards:",-1)),(0,r.bo)((0,r.Lk)("input",{type:"input","onUpdate:modelValue":t[4]||(t[4]=e=>a.typeCards=e),placeholder:"如: 6,7,8 或 7,7"},null,512),[[s.Jo,a.typeCards]]),(0,r.Lk)("button",{onClick:t[5]||(t[5]=(...e)=>u.checkType&&u.checkType(...e))},"Check Type"),a.typeResult?((0,r.uX)(),(0,r.CE)("div",ht,"Type: "+(0,i.v_)(a.typeResult),1)):(0,r.Q3)("",!0)])])}var pt={name:"TestTable",created(){},data(){return{selectedCards:"",lastCards:"",result:null,selType:"",lastType:"",sampleResults:[],typeCards:"",typeResult:""}},methods:{parseInput(e){const t={S:"♠",H:"♥",C:"♣",D:"♦"};return(e||"").split(",").map(e=>e.trim()).filter(e=>e.length>0).map(e=>{const n=e.match(/^([♠♥♣♦]|[SHCD])?\s*(10|[4-9]|[JQKA]|2|3|5)$/i);if(!n)return null;const s=n[1]?t[n[1].toUpperCase()]||n[1]:"♠",r=n[2].toUpperCase();return{suit:s,value:r}}).filter(Boolean)},testPlay(){const e=this.parseInput(this.selectedCards),t=this.parseInput(this.lastCards),n=Z(e,t);this.result=n,this.selType=te(e),this.lastType=te(t)},formatType(e){const t={single:"单张",pair:"对子",triple:"轰",bomb:"炸",straight:"顺子",doubleStraight:"连对",invalid:"无效"};return t[e]||e},checkType(){const e=this.parseInput(this.typeCards),t=te(e);this.typeResult=this.formatType(t)},runSamples(){const e=[{selected:"7",last:"",expect:!0},{selected:"8",last:"7",expect:!0},{selected:"7",last:"7",expect:!1},{selected:"8,8",last:"7,7",expect:!0},{selected:"7,7",last:"7,7",expect:!1},{selected:"6,7,8",last:"4,6,7",expect:!0},{selected:"K,A",last:"Q,K",expect:!0},{selected:"A,2",last:"K,A",expect:!1},{selected:"7,7,7",last:"K",expect:!0},{selected:"7,7,7",last:"7,7,7,7",expect:!1},{selected:"9,9,9",last:"7,7,7",expect:!0}];this.sampleResults=e.map(e=>{const t=this.parseInput(e.selected),n=this.parseInput(e.last),s=Z(t,n);return{...e,actual:s}})}}};const gt=(0,Ue.A)(pt,[["render",ft],["__scopeId","data-v-5f71be02"]]);var vt=gt,yt={name:"App",components:{GameTable:at,TestTable:vt},data(){return{showGame:!1,showTest:!1}}};const mt=(0,Ue.A)(yt,[["render",a]]);var bt=mt;(0,s.Ef)(bt).mount("#app"),"undefined"!==typeof window&&document.addEventListener("dblclick",function(e){e.preventDefault()},{passive:!1})}},t={};function n(s){var r=t[s];if(void 0!==r)return r.exports;var l=t[s]={exports:{}};return e[s].call(l.exports,l,l.exports,n),l.exports}n.m=e,function(){var e=[];n.O=function(t,s,r,l){if(!s){var a=1/0;for(c=0;c<e.length;c++){s=e[c][0],r=e[c][1],l=e[c][2];for(var i=!0,u=0;u<s.length;u++)(!1&l||a>=l)&&Object.keys(n.O).every(function(e){return n.O[e](s[u])})?s.splice(u--,1):(i=!1,l<a&&(a=l));if(i){e.splice(c--,1);var o=r();void 0!==o&&(t=o)}}return t}l=l||0;for(var c=e.length;c>0&&e[c-1][2]>l;c--)e[c]=e[c-1];e[c]=[s,r,l]}}(),function(){n.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return n.d(t,{a:t}),t}}(),function(){n.d=function(e,t){for(var s in t)n.o(t,s)&&!n.o(e,s)&&Object.defineProperty(e,s,{enumerable:!0,get:t[s]})}}(),function(){n.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}()}(),function(){n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)}}(),function(){var e={524:0};n.O.j=function(t){return 0===e[t]};var t=function(t,s){var r,l,a=s[0],i=s[1],u=s[2],o=0;if(a.some(function(t){return 0!==e[t]})){for(r in i)n.o(i,r)&&(n.m[r]=i[r]);if(u)var c=u(n)}for(t&&t(s);o<a.length;o++)l=a[o],n.o(e,l)&&e[l]&&e[l][0](),e[l]=0;return n.O(c)},s=self["webpackChunkjihei5"]=self["webpackChunkjihei5"]||[];s.forEach(t.bind(null,0)),s.push=t.bind(null,s.push.bind(s))}();var s=n.O(void 0,[504],function(){return n(492)});s=n.O(s)})();
//# sourceMappingURL=app.d8f52438.js.map